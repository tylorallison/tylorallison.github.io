
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://tylorallison.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://tylorallison.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://tylorallison.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://tylorallison.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tylor Allison Atom">


    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Tylor Allison" />
<meta name="description" content="Intro So... I've been playing with Unity now for a year or so. And while I'm not a prolific Unity developer by any stretch of the imagination, I am getting to the point where I've worked on multiple projects and have had a need to reuse bits and pieces of …" />
<meta name="keywords" content="gamedev, unity, modularity, git, workflow, submodule">
<meta property="og:site_name" content="Tylor Allison"/>
<meta property="og:title" content="Building a Modular Unity Workflow"/>
<meta property="og:description" content="Intro So... I've been playing with Unity now for a year or so. And while I'm not a prolific Unity developer by any stretch of the imagination, I am getting to the point where I've worked on multiple projects and have had a need to reuse bits and pieces of …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://tylorallison.github.io/building-a-modular-unity-workflow.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-08-15 00:00:00-07:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://tylorallison.github.io/author/tylor-allison.html">
<meta property="article:section" content="tutorial"/>
<meta property="article:tag" content="gamedev"/>
<meta property="article:tag" content="unity"/>
<meta property="article:tag" content="modularity"/>
<meta property="article:tag" content="git"/>
<meta property="article:tag" content="workflow"/>
<meta property="article:tag" content="submodule"/>
<meta property="og:image" content="//s.gravatar.com/avatar/221e6e31de6232bf3175b820a4a961e7?s=120">

  <title>Tylor Allison &ndash; Building a Modular Unity Workflow</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://tylorallison.github.io">
        <img src="//s.gravatar.com/avatar/221e6e31de6232bf3175b820a4a961e7?s=120" alt="Tylor Allison" title="Tylor Allison">
      </a>
      <h1><a href="https://tylorallison.github.io">Tylor Allison</a></h1>

<p>Game Developer</p>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/tylor-allison" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://github.com/tylorallison" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-bitbucket" href="https://bitbucket.com/ptjal" target="_blank"><i class="fa fa-bitbucket"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/TyAllison" target="_blank"><i class="fa fa-twitter"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://tylorallison.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://tylorallison.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="building-a-modular-unity-workflow">Building a Modular Unity Workflow</h1>
    <p>
          Posted on Tue 15 August 2017 in <a href="https://tylorallison.github.io/category/tutorial.html">tutorial</a>


    </p>
  </header>


  <div>
    <h3>Intro</h3>
<p>So... I've been playing with Unity now for a year or so.  And while I'm not a prolific Unity
developer by any stretch of the imagination, I am getting to the point where I've worked on
multiple projects and have had a need to reuse bits and pieces of projects.  Now, being the
practical guy I am, I've started doing this by taking the path of least resistance... just
copy-n-paste the code I need into the separate projects, editing as required to remove
project-specific stuff like namespaces, local submodules, etc.  And I guess this works for some
definition of <em>works</em>.  It seems like it never fails that while I'm updating code for re-use,
that I'll find some minor (or major) improvement on that code, but will only make the change for
the new code base.</p>
<p>Also, I'm trying to get into the practice of actually testing my code (ya, crazy I know), which leads to additional complexity when trying to cut-n-paste and maintain both the code and tests.</p>
<p>Cutting to the chase... what I'm going to present is how I've tackled this issue using git
submodules, symlinks and some simple workflow rules.</p>
<h3>Basics</h3>
<p>There's a few assumptions that I'm going to make here:</p>
<ul>
<li>You're using Unity and have C# projects</li>
<li>You're using git for version control</li>
<li>You're using <strong>OSX Unity</strong> or are comfortable enough with Windows to translate my unix commands (sorry, haven't tested on Windows)</li>
<li>You have code that is modular and want to use it across multiple projects</li>
</ul>
<p>To accomplish this last point, I've identified pieces of projects that I want to break out into
separate modules.  For the most part, these modules provide a specific set of classes/functions and are self-contained with very few dependencies on other modules.  Best to plan for this up front if you can.</p>
<h3>Full Unity Projects</h3>
<p>To start with, each of my modules is a full unity project.  This allows me to do things like
maintain test scenes with integration tests and have project specific unit tests.  I use a
specific folder structure so that when I link modules together, only the module code gets
integrated.</p>
<p>So, starting with the standard Unity project folders for an example module named <strong>mymodule</strong>:</p>
<div class="highlight"><pre><span></span>mymodule/
    ProjectSettings/
    Library/
    Assets/
</pre></div>


<p>I build out the Assets folder like this:</p>
<div class="highlight"><pre><span></span>mymodule/Assets/
    Plugins/
    Scenes/
    Scripts/
        test/
            Editor/
        mymodule/
</pre></div>


<p>The <strong>Plugins</strong> folder will be used for linking modules together, so it might not be needed for every project.  The <strong>Scenes</strong> folder is for all of your Unity scenes.  Under <strong>Scripts</strong>, you'll note there are two separate folders.  A <strong>test</strong> folder and another <strong>mymodule</strong> folder.  I use the <strong>test</strong> folder for all of my project specific tests, including unit tests (under the <strong>Editor</strong> folder) and Unity integration tests (e.g.: scripts for test scenes, etc.).  All of the module code would go under the second <strong>mymodule</strong> folder.  This second project folder will be used when we link project code together ... to be explained below.</p>
<p>To avoid name collisions and keep everything tidy, I use a separate namespace for each
module/project.</p>
<h3>Git Submodules</h3>
<p>The whole key for how modules are going to work is through the use of <a href="https://git-scm.com/docs/git-submodule">Git Submodules</a> to pull in the external module and the use of symlinks to pull only the code portion of the external module into the referencing project.</p>
<p>The best way to explain this is probably to walk through a real example.  In this case, I have
two existing modules that I want to reference in a third:</p>
<ul>
<li><a href="https://bitbucket.org/ptjal/tytest">tytest</a> - A simple test framework</li>
<li><a href="https://bitbucket.org/ptjal/tymesh">tymesh</a> - A utility class for working with dynamic meshes</li>
<li><a href="https://bitbucket.org/ptjal/tysimpleshape">tysimpleshape</a> - Another utility class that provide simple methods for drawing lines/dots in Unity</li>
</ul>
<p>Let's start by assuming that <strong>tytest</strong> and <strong>tymesh</strong> already exist and are already under
upstream git control.  Let's also assume that I have <strong>tysimpleshape</strong> built out as a Unity
project and is under local git control.  <strong>tysimpleshape</strong> directly references the <strong>tymesh</strong>
module, as it is using the <em>IMeshData</em> interface to build out the mesh for simple objects.  It also
references the <strong>tytest</strong> module for defining a few simple unity integration tests which show
off the rendering of the simple shapes.  Following the directory structure I outlined above,
I've created the following directory tree for this <strong>tysimpleshape</strong> project:</p>
<div class="highlight"><pre><span></span>tysimpleshape/Assets/
    Plugins/
    Scenes/
    Scripts/
        test/
        tysimpleshape/
</pre></div>


<p>Linking the dependent modules is actually pretty straightforward.</p>
<p>Create a top-level submodules folder under the main <strong>tysimpleshape</strong> folder and change into that folder:</p>
<div class="highlight"><pre><span></span><span class="c">% cd ~/repos/tysimpleshape</span>
<span class="c">% mkdir submodules</span>
<span class="c">% cd submodules</span>
</pre></div>


<p>Now, tell git to add the appropriate submodules using the <strong>git submodule</strong> command:</p>
<div class="highlight"><pre><span></span><span class="c">% git submodule add https://bitbucket.org/ptjal/tytest</span>
<span class="c">% git submodule add https://bitbucket.org/ptjal/tymesh</span>
</pre></div>


<p>That wasn't so bad, but we're not quite done yet.  First a note on what this actually does... it
makes a copy of both of these git repositories under the submodules folder and tells git to keep
track of these submodules as being part of the current repository (<strong>tysimpleshape</strong>).  It uses
the current head of each of these repositories at the time that you create the submodule
reference.  This is important to note, as making changes to these upstream modules will not
automatically be replicated into the referencing module.  You'll have to update the links
manually (to be covered below).  </p>
<p>One other note on the command that was run is that we did not tell submodule to run recursively.
This means that if any of the submodules that we reference have dependencies of their own, we
won't pick those subdependencies up automatically.  And this is actually by design.  I want to
try to keep the dependency tree flat and so if there are dependencies on using a submodule, I
actually want the referencing module to own that dependency.  There might be better ways to
handle this, but for now this is working for me.  This doesn't apply for this example, as there
are no nested dependencies in any of these modules.</p>
<p>To see the current status of affairs after running these submodule commands:</p>
<div class="highlight"><pre><span></span><span class="c">% git submodule status</span>
<span class="mi">2875038</span><span class="n">fba3f4b4a5b9bb27442e88aa9bbe6adff</span> <span class="n">submodules</span><span class="o">/</span><span class="n">tymesh</span> <span class="p">(</span><span class="n">heads</span><span class="o">/</span><span class="n">master</span><span class="p">)</span>
<span class="mi">9</span><span class="n">b0cb96504a1704b5a65827090a628890be4f2d7</span> <span class="n">submodules</span><span class="o">/</span><span class="n">tytest</span> <span class="p">(</span><span class="n">heads</span><span class="o">/</span><span class="n">master</span><span class="p">)</span>

<span class="c">% git status</span>
<span class="n">On</span> <span class="n">branch</span> <span class="n">master</span>
<span class="n">Your</span> <span class="n">branch</span> <span class="n">is</span> <span class="n">up</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">date</span> <span class="n">with</span> <span class="s">&#39;origin/master&#39;</span><span class="p">.</span>
<span class="n">Changes</span> <span class="n">to</span> <span class="n">be</span> <span class="n">committed</span><span class="p">:</span>
  <span class="p">(</span><span class="n">use</span> &quot;<span class="n">git</span> <span class="n">reset</span> <span class="n">HEAD</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="c">...&quot; to unstage)</span>

    <span class="n">new</span> <span class="n">file</span><span class="p">:</span>   <span class="p">.</span><span class="n">gitmodules</span>
    <span class="n">new</span> <span class="n">file</span><span class="p">:</span>   <span class="n">submodules</span><span class="o">/</span><span class="n">tymesh</span>
    <span class="n">new</span> <span class="n">file</span><span class="p">:</span>   <span class="n">submodules</span><span class="o">/</span><span class="n">tytest</span>
</pre></div>


<p>Before going on, commit the current changes and push changes upstream.</p>
<div class="highlight"><pre><span></span><span class="c">% git commit -m &quot;linked submodules tymesh and tytest&quot;</span>
<span class="c">% git push -u origin master</span>
</pre></div>


<p>We now have the repositories/modules that we reference into our referencing module's repository, but we're not quite ready yet.  Remember that each of the repositories in this scheme are full Unity projects.  We really don't want all of the other project files to show up in the Unity editor for the current project (e.g.: extra scenes, tests, etc.).  By linking the submodules to a top-level directory under the project, Unity will not automatically process the Assets folder in the submodules.  But, we need to make Unity aware of our module code somehow... To make this work, we're going to do something that Unity tells us not to do, create symlinks in projects.  But, we actually do know what we are doing in this case, and it will be OK, trust me.</p>
<p>So, let's create those symlinks:</p>
<p>Change the working directory to the <strong>Plugins</strong> directory:</p>
<div class="highlight"><pre><span></span><span class="c">% cd ~/repos/tysimpleshape/Assets/Plugins</span>
</pre></div>


<p>Create relative links to the submodules.  Note that we use the module code folder under <strong>Scripts</strong>.  This is what makes this work.  We are only pulling in the code from the modules, not the rest of the Unity project files by doing it this way.</p>
<div class="highlight"><pre><span></span><span class="c">% ln -s ../../submodules/tymesh/Assets/Scripts/tymesh .</span>
<span class="c">% ln -s ../../submodules/tytest/Assets/Scripts/tytest .</span>
<span class="c">% ls -l</span>
<span class="n">total</span> <span class="mi">16</span>
<span class="n">lrwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">1</span> <span class="n">tylor</span>  <span class="n">staff</span>  <span class="mi">45</span> <span class="n">Aug</span> <span class="mi">15</span> <span class="mi">10</span><span class="p">:</span><span class="mi">29</span> <span class="n">tymesh</span><span class="p">@</span> <span class="o">-&gt;</span> <span class="p">.</span><span class="o">./</span><span class="p">.</span><span class="o">./</span><span class="n">submodules</span><span class="o">/</span><span class="n">tymesh</span><span class="o">/</span><span class="n">Assets</span><span class="o">/</span><span class="n">Scripts</span><span class="o">/</span><span class="n">tymesh</span>
<span class="n">lrwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">1</span> <span class="n">tylor</span>  <span class="n">staff</span>  <span class="mi">45</span> <span class="n">Aug</span> <span class="mi">15</span> <span class="mi">10</span><span class="p">:</span><span class="mi">29</span> <span class="n">tytest</span><span class="p">@</span> <span class="o">-&gt;</span> <span class="p">.</span><span class="o">./</span><span class="p">.</span><span class="o">./</span><span class="n">submodules</span><span class="o">/</span><span class="n">tytest</span><span class="o">/</span><span class="n">Assets</span><span class="o">/</span><span class="n">Scripts</span><span class="o">/</span><span class="n">tytest</span>
</pre></div>


<p>And that's it.  Your Unity project should now build, referencing the submodules that you need.</p>
<h3>Maintaining Submodules</h3>
<p>As I mentioned above, when you create a reference to a submodule, git will determine the current
head of the submodule and store that as a reference.  If you make changes to the upstream
module, you won't see those changes until you tell git to update the local references.  Again,
this is super easy (as of git 1.8.2):</p>
<div class="highlight"><pre><span></span><span class="c">% git submodule update --remote --merge</span>
</pre></div>


<p>To keep things simple, I strongly encourage you to only change referenced submodules upstream,
not locally within the local submodule links.  I know you can do this, I just find it less
confusing not to.</p>
<h3>Git Clone with Submodules</h3>
<p>The above steps get you setup with your github repo referencing submodules.  But what if you
want to clone a git repo that already has submodule references?  Git clone will not
automatically follow submodule references, but you can tell it to:</p>
<div class="highlight"><pre><span></span><span class="c">% git clone --recursive https://ptjal@bitbucket.org/ptjal/tysimpleshape.git</span>
</pre></div>


<h3>Try It Out</h3>
<p>The referenced repositories are public.  Feel free to try it out and/or poke around.  Not much
to look at, but here's my little simple shape test:</p>
<p><img alt="Test Shapes" class="img-center" src="images/TestShapes.png"></p>
<h3>Credits</h3>
<p>No, I didn't come up with all myself.  In fact, most of what I'm doing has been described in
<a href="http://blog.prime31.com/a-method-for-working-with-shared-code-with-unity-and-git/">Prime31's Blog</a>.  I changed up some of the directory layout to suit my needs.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://tylorallison.github.io/tag/gamedev.html">gamedev</a>
      <a href="https://tylorallison.github.io/tag/unity.html">unity</a>
      <a href="https://tylorallison.github.io/tag/modularity.html">modularity</a>
      <a href="https://tylorallison.github.io/tag/git.html">git</a>
      <a href="https://tylorallison.github.io/tag/workflow.html">workflow</a>
      <a href="https://tylorallison.github.io/tag/submodule.html">submodule</a>
    </p>
  </div>




<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'tylorallisonblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>&copy; Tylor Allison 2017</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Tylor Allison ",
  "url" : "https://tylorallison.github.io",
  "image": "//s.gravatar.com/avatar/221e6e31de6232bf3175b820a4a961e7?s=120",
  "description": ""
}
</script>
</body>
</html>